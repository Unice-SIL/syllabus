{% extends 'ajax.html.twig' %}

{% block stylesheets %}
{% endblock %}

{% block main %}
    {% form_theme form 'form/teachers_theme.html.twig' %}
    {{ form_start(form) }}
    {{ form_widget(form.teacherSource) }}
    {{ form_widget(form.teacherSearch) }}
    <ul class="list-group" id="teachers"
        data-prototype="{{ form_widget(form.teachers.vars.prototype)|e('html_attr') }}">
        {% for teacher in form.teachers %}
            <li class="list-group-item teacher">
                {{ form_row(teacher.completeName) }}
                {{ form_widget(teacher) }}
            </li>
        {% endfor %}
    </ul>
    {{ form_widget(form) }}
    <button class="btn btn-outline-secondary btn-block submit" type="submit">
        Save
    </button>
    {{ form_end(form) }}

{% endblock %}

{% block javascripts %}

    <script src="{{ asset('bundles/tetranzselect2entity/js/select2entity.js') }}"></script>
    <script>

        /**
         *
         */
        $(document).ready(function(){
            var teachersCollectionHolder = $('#teachers');
            teachersCollectionHolder.data('index', teachersCollectionHolder.find('li').length);
            teachersCollectionHolder.find('li').each(function(){
                addActionsToForm($(this));
            });
            $( '#edit_presentation_course_info_teacherSearch' ).on( 'select2:select', function( ) {
                $.ajax({
                    url: '{{ path('find_course_teacher_json') }}',
                    type: 'GET',
                    data: {
                        'source': $('#edit_presentation_course_info_teacherSource').val(),
                        'id': $('#edit_presentation_course_info_teacherSearch').val()
                    },
                    success: function(data){
                        var form = addFormToCollection(teachersCollectionHolder, data);
                        addActionsToForm(form, 'list-group-item teacher');
                        form.find('input[id*=_completeName]').val(data['completeName']);
                        form.find('input[id*=_id]').val(data['id']);
                        form.find('input[id*=_firstname]').val(data['firstname']);
                        form.find('input[id*=_lastname]').val(data['lastname']);
                        form.find('input[id*=_email]').val(data['email']);
                        $('#edit_presentation_course_info_teacherSearch').find('option').remove();
                        $('#select2-edit_presentation_course_info_teacherSearch-container').html('');
                    }
                });
            } );


            $("form[name='edit_presentation_course_info']").submit(function(e){
                e.preventDefault();
                $.ajax({
                    type: 'POST',
                    url: '{{ path('save_presentation_course_info', { 'id': courseInfo.id })|escape('js') }}',
                    data: $(this).closest('form').serialize()
                }).done(function(){
                    alert('done');
                });
            });
        });

    </script>
{% endblock %}